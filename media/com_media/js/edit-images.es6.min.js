Joomla=window.Joomla||{},Joomla.MediaManager=Joomla.MediaManager||{},(()=>{"use strict";const e=Joomla.getOptions("com_media",{});if(!e)throw new Error('Initialization error "edit-images.js"');Joomla.MediaManager.Edit.original={filename:e.uploadPath.split("/").pop(),extension:e.uploadPath.split(".").pop(),contents:`data:image/${e.uploadPath.split(".").pop()};base64,${e.contents}`},Joomla.MediaManager.Edit.history={},Joomla.MediaManager.Edit.current={};const a=(e,a)=>{if(!a.contents)return;const t=document.getElementById("media-manager-edit-container"),o=document.createElement("div"),i=document.createElement("div"),n=document.createElement("img"),r=document.createElement("img");t.innerHTML="",n.src=a.contents,n.id="image-source",n.style.maxWidth="100%",r.src=a.contents,r.id="image-preview",r.style.maxWidth="100%",o.style.display="none",o.appendChild(n),t.appendChild(o),i.appendChild(r),t.appendChild(i),Joomla.MediaManager.Edit[e.toLowerCase()].Activate(a)};Joomla.MediaManager.Edit.Reset=(e=>{(!e||e&&"initial"===e)&&(Joomla.MediaManager.Edit.current.contents=Joomla.MediaManager.Edit.original.contents),document.getElementById("media-manager-edit-container").innerHTML="";const t=document.getElementById("myTab").firstElementChild;"UL"===t.tagName&&[].slice.call(t.querySelectorAll("a")).forEach(t=>{if(!t.classList.contains("active"))return;Joomla.MediaManager.Edit[t.id.replace("tab-attrib-","").toLowerCase()].Deactivate();let o=Joomla.MediaManager.Edit.current;(!e||e&&!0!==e)&&(o=Joomla.MediaManager.Edit.original),t.click();const i=document.getElementById("media-manager-edit-container");document.getElementById(t.id.id.replace("tab-","")).insertAdjacentElement("afterbegin",i),a(t.id.replace("tab-attrib-",""),o)})}),window.addEventListener("mediaManager.history.point",()=>{if(Joomla.MediaManager.Edit.original!==Joomla.MediaManager.Edit.current.contents){const e=Object.keys(Joomla.MediaManager.Edit.history).length;if(Joomla.MediaManager.Edit.history[e]&&Joomla.MediaManager.Edit.history[e-1]&&Joomla.MediaManager.Edit.history[e]===Joomla.MediaManager.Edit.history[e-1])return;Joomla.MediaManager.Edit.history[e+1]=Joomla.MediaManager.Edit.current.contents}}),Joomla.MediaManager.Edit.Undo=(()=>{}),Joomla.MediaManager.Edit.Redo=(()=>{}),Joomla.MediaManager.Edit.createProgressBar=(()=>{}),Joomla.MediaManager.Edit.updateProgressBar=(()=>{}),Joomla.MediaManager.Edit.removeProgressBar=(()=>{}),Joomla.submitbutton=(a=>{const t="jpg"===Joomla.MediaManager.Edit.original.extension?"jpeg":Joomla.MediaManager.Edit.original.extension,o=window.location.pathname.replace(/&view=file.*/g,""),i=e.uploadPath.split("/").pop(),n={name:i,content:Joomla.MediaManager.Edit.current.contents.replace(`data:image/${t};base64,`,"")},r=e.uploadPath,d=`${e.apiBaseUrl}&task=api.files&path=${r}`,l="application/json";n[e.csrfToken]="1";let s=r.split("/");switch(s.pop(),(s=s.join("/")).endsWith(":")&&(s=`${s}/`),a){case"apply":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l),Joomla.MediaManager.Edit.Reset(!0);break;case"save":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l),window.location=`${o}?option=com_media&path=${s}`;break;case"cancel":window.location=`${o}?option=com_media&path=${s}`;break;case"reset":Joomla.MediaManager.Edit.Reset("initial")}}),Joomla.UploadFile={},Joomla.UploadFile.exec=((e,a,t,o,i)=>{const n=new XMLHttpRequest;n.upload.onprogress=(e=>{Joomla.MediaManager.Edit.updateProgressBar(e.loaded/e.total*100)}),n.onload=(()=>{let e;try{e=JSON.parse(n.responseText)}catch(a){e=null}e?200===n.status&&(!0===e.success&&Joomla.MediaManager.Edit.removeProgressBar(),"1"===e.status&&(Joomla.renderMessages({success:[e.message]},"true"),Joomla.MediaManager.Edit.removeProgressBar())):Joomla.MediaManager.Edit.removeProgressBar()}),n.onerror=(()=>{Joomla.MediaManager.Edit.removeProgressBar()}),n.open("PUT",o,!0),n.setRequestHeader("Content-Type",i),Joomla.MediaManager.Edit.createProgressBar(),n.send(a)}),document.addEventListener("DOMContentLoaded",()=>{const e=()=>{const t=document.getElementById("myTab").firstElementChild;if("UL"!==t.tagName)return void setTimeout(e,50);const o=[].slice.call(t.querySelectorAll("a"));o[0]&&a(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original),o.forEach(e=>{e.addEventListener("joomla.tab.shown",e=>{const t=document.getElementById("media-manager-edit-container");e.relatedTarget&&(Joomla.MediaManager.Edit[e.relatedTarget.id.replace("tab-attrib-","").toLowerCase()].Deactivate(),t.innerHTML="");let o=Joomla.MediaManager.Edit.current;"contents"in Joomla.MediaManager.Edit.current||(o=Joomla.MediaManager.Edit.original),document.getElementById(e.target.id.replace("tab-","")).insertAdjacentElement("afterbegin",t),a(e.target.id.replace("tab-attrib-",""),o)}),e.click()}),o[0]&&(o[0].click(),a(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original))};setTimeout(e,50)})})();