tinymce.PluginManager.add("jdragdrop",e=>{tinyMCE.DOM.bind(document,"dragleave",e=>(e.stopPropagation(),e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="1px 0 0",!1));"undefined"!=typeof FormData?(e.on("dragenter",e=>(e.stopPropagation(),!1)),e.on("dragover",t=>(t.preventDefault(),e.contentAreaContainer.style.borderStyle="dashed",e.contentAreaContainer.style.borderWidth="5px",!1)),e.on("drop",t=>{if(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length>0){[].slice.call(t.dataTransfer.files).forEach(a=>{if(a.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)){const t=document.createElement("div");t.id="jloader";const o=document.createElement("div");o.classList.add("progress"),o.classList.add("progress-success"),o.classList.add("progress-striped"),o.classList.add("active"),o.style.width="100%",o.style.height="30px";const r=document.createElement("div");r.classList.add("bar"),r.style.width="0",o.appendChild(r),t.appendChild(o),document.querySelector(".mce-toolbar-grp").appendChild(t),(t=>{const a=new FormData;a.append("Filedata",t),a.append("folder",tinyMCE.activeEditor.settings.mediaUploadPath);const o=new XMLHttpRequest;o.upload.onprogress=(e=>{const t=e.loaded/e.total*100;document.querySelector(".bar").style.width=`${t}%`});const r=()=>{setTimeout(()=>{const t=document.querySelector("#jloader");t.parentNode.removeChild(t),e.contentAreaContainer.style.borderWidth="1px 0 0 0"},200)};o.onload=(()=>{const t=JSON.parse(o.responseText);if(200===o.status){if("0"===t.status&&(r(),e.windowManager.alert(`${t.message}: ${tinyMCE.activeEditor.settings.setCustomDir}${t.location}`)),"1"===t.status){r();const e=tinyMCE.activeEditor.getDoc().createElement("img");e.src=tinyMCE.activeEditor.settings.setCustomDir+t.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,e.outerHTML)}}else r()}),o.onerror=(()=>{r()}),o.open("POST",tinyMCE.activeEditor.settings.uploadUri,!0),o.send(a)})(a)}t.preventDefault()})}e.contentAreaContainer.style.borderWidth="1px 0 0"})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),e.on("drop",e=>(e.preventDefault(),!1)))});