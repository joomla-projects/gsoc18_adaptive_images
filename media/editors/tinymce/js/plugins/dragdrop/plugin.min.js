tinymce.PluginManager.add("jdragdrop",function(e){tinyMCE.DOM.bind(document,"dragleave",function(e){return e.stopPropagation(),e.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="1px 0 0",!1});"undefined"!=typeof FormData?(e.on("dragenter",function(e){return e.stopPropagation(),!1}),e.on("dragover",function(t){return t.preventDefault(),e.contentAreaContainer.style.borderStyle="dashed",e.contentAreaContainer.style.borderWidth="5px",!1}),e.on("drop",function(t){t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length>0&&[].slice.call(t.dataTransfer.files).forEach(function(n){if(n.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)){var r=document.createElement("div");r.id="jloader";var a=document.createElement("div");a.classList.add("progress"),a.classList.add("progress-success"),a.classList.add("progress-striped"),a.classList.add("active"),a.style.width="100%",a.style.height="30px";var o=document.createElement("div");o.classList.add("bar"),o.style.width="0",a.appendChild(o),r.appendChild(a),document.querySelector(".mce-toolbar-grp").appendChild(r),function(t){var n=new FormData;n.append("Filedata",t),n.append("folder",tinyMCE.activeEditor.settings.mediaUploadPath);var r=new XMLHttpRequest;r.upload.onprogress=function(e){var t=e.loaded/e.total*100;document.querySelector(".bar").style.width=t+"%"};var a=function(){setTimeout(function(){var t=document.querySelector("#jloader");t.parentNode.removeChild(t),e.contentAreaContainer.style.borderWidth="1px 0 0 0"},200)};r.onload=function(){var t=JSON.parse(r.responseText);if(200===r.status){if("0"===t.status&&(a(),e.windowManager.alert(t.message+": "+tinyMCE.activeEditor.settings.setCustomDir+t.location)),"1"===t.status){a();var n=tinyMCE.activeEditor.getDoc().createElement("img");n.src=tinyMCE.activeEditor.settings.setCustomDir+t.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,n.outerHTML)}}else a()},r.onerror=function(){a()},r.open("POST",tinyMCE.activeEditor.settings.uploadUri,!0),r.send(n)}(n)}t.preventDefault()});e.contentAreaContainer.style.borderWidth="1px 0 0"})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),e.on("drop",function(e){return e.preventDefault(),!1}))});
