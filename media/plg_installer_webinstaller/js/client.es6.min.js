if(!window.jQuery)throw new Error("WebInstaller plugin requires jQuery");if(!Joomla)throw new Error("Joomla API is not properly initialised");((e,t,i,l)=>{"use strict";const s={view:"dashboard",id:0,ordering:"",list:0,options:i.getOptions("plg_installer_webinstaller",{})};let n;class a{initialise(){if(s.loaded=1,t.getElementById("myTabContent")){const e=t.getElementById("web");t.getElementById("uploadform-web-cancel").addEventListener("click",()=>{t.getElementById("uploadform-web").classList.add("hidden"),s.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click()}),e.insertAdjacentHTML("afterbegin",'<div id="appsloading" class="ifw-loading-container"></div>'),e.style.position="absolute",l("#appsloading").on("ajaxStart",()=>{t.body.classList.add("ifw-busy"),t.getElementById("appsloading").classList.remove("hidden")}).on("ajaxStop",()=>{t.getElementById("appsloading").classList.add("hidden"),t.body.classList.remove("ifw-busy")})}this.loadweb(`${s.options.base_url}index.php?format=json&option=com_apps&view=dashboard`),this.clickforlinks()}loadweb(n){if(!n)return!1;const r=new RegExp(s.options.base_url),o=new RegExp("^index.php");if(!r.test(n)&&!o.test(n))return e.open(n,"_blank"),!1;let d=`${n}&product=${s.options.product}&release=${s.options.release}&dev_level=${s.options.dev_level}&list=${s.list?"list":"grid"}&lang=${s.options.language}`;if(""!==s.ordering&&t.getElementById("com-apps-ordering").value&&(s.ordering=t.getElementById("com-apps-ordering").value,d+=`&ordering=${s.ordering}`),t.getElementById("myTabContent")){const e=t.getElementById("appsloading");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%";const i=t.getElementById("web");i.style.position="relative",i.appendChild(e),l("#appsloading").trigger("ajaxStart")}return l.ajax({url:d,dataType:"jsonp",cache:!0,jsonpCallback:"jedapps_jsonpcallback",timeout:2e4,success:e=>{t.getElementById("web-loader")&&t.getElementById("web-loader").classList.add("hidden"),t.getElementById("jed-container").innerHTML=e.data.html,t.getElementById("com-apps-searchbox").addEventListener("keypress",e=>{13===e.which&&this.initiateSearch()}),t.getElementById("search-extensions").addEventListener("click",()=>{this.initiateSearch()}),t.getElementById("search-reset").addEventListener("click",()=>{t.getElementById("com-apps-searchbox").value="",this.initiateSearch()});const i=t.getElementById("com-apps-ordering");i&&i.addEventListener("change",()=>{const e=i.selectedIndex;s.ordering=i.options[e].value,this.installfromwebajaxsubmit()}),""!==s.options.installfrom_url&&a.installfromweb(s.options.installfrom_url)},fail:()=>{t.getElementById("web-loader")&&(t.getElementById("web-loader").classList.add("hidden"),t.getElementById("web-loader-error").classList.remove("hidden"))},complete:()=>{const n=t.getElementById("joomlaapsinstallatinput");if(n&&(n.value=s.options.installat_url),this.clickforlinks(),a.clicker(),"extension"!==s.view&&[].slice.call(t.querySelectorAll("div.load-extension")).forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.processLinkClick(e.getAttribute("data-url"))}),e.setAttribute("href","#")}),"extension"===s.view){const l=t.getElementById("install-extension"),s=t.getElementById("install-extension-from-external");l&&l.addEventListener("click",()=>{a.installfromweb(l.getAttribute("data-downloadurl"),l.getAttribute("data-name"))}),s&&s.addEventListener("click",()=>{const l=s.getAttribute("data-downloadurl");!0===e.confirm(i.JText._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",l))&&(t.getElementById("adminForm").setAttribute("action",l),t.querySelector("input[name=task]").setAttribute("disabled",!0),t.querySelector("input[name=install_directory]").setAttribute("disabled",!0),t.querySelector("input[name=install_url]").setAttribute("disabled",!0),t.querySelector("input[name=installtype]").setAttribute("disabled",!0),t.querySelector("input[name=filter_search]").setAttribute("disabled",!0),t.getElementById("adminForm").submit())})}s.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click(),t.getElementById("myTabContent")&&l("#appsloading").trigger("ajaxStop")},error:e=>{const i=t.getElementById("web-loader-error"),l=t.getElementById("web-loader");e.responseText&&i&&(i.innerHTML=e.responseText),l&&(l.classList.add("hidden"),i.classList.remove("hidden"))}}),!0}clickforlinks(){[].slice.call(t.querySelectorAll("a.transcode")).forEach(e=>{const t=e.getAttribute("href");e.addEventListener("click",e=>{e.preventDefault(),this.processLinkClick(t)}),e.setAttribute("href","#")})}initiateSearch(){s.view="dashboard",this.installfromwebajaxsubmit()}installfromwebajaxsubmit(){let e=`&view=${s.view}`;if(s.id&&(e+=`&id=${s.id}`),t.getElementById("com-apps-searchbox").value){e+=`&filter_search=${encodeURI(t.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim())}`}""!==s.ordering&&t.getElementById("com-apps-ordering").value&&(s.ordering=t.getElementById("com-apps-ordering").value),s.ordering&&(e+=`&ordering=${s.ordering}`),this.loadweb(`${s.options.base_url}index.php?format=json&option=com_apps${e}`)}processLinkClick(e){const t=new RegExp(s.options.base_url),i=new RegExp("^index.php");t.test(e)||i.test(e)?(s.view=e.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===s.view?s.id=0:"category"===s.view&&(s.id=e.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(s.options.base_url+e)):this.loadweb(e)}static clicker(){t.querySelector(".grid-view")&&t.querySelector(".grid-view").addEventListener("click",()=>{s.list=0,t.querySelector(".list-container").classList.add("hidden"),t.querySelector(".grid-container").classList.remove("hidden"),t.getElementById("btn-list-view").classList.remove("active"),t.getElementById("btn-grid-view").classList.remove("active")}),t.querySelector(".list-view")&&t.querySelector(".list-view").addEventListener("click",()=>{s.list=1,t.querySelector(".grid-container").classList.add("hidden"),t.querySelector(".list-container").classList.remove("hidden"),t.getElementById("btn-grid-view").classList.remove("active"),t.getElementById("btn-list-view").classList.add("active")})}static installfromweb(e,l=null){if(!e)return alert(i.JText._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")),!1;const s=t.getElementById("install_url"),n=t.getElementById("uploadform-web-url");if(s.value=e,n.innerHTML=e,l){t.getElementById("uploadform-web-name").innerHTML=l,t.getElementById("uploadform-web-name-label").classList.remove("hidden")}else t.getElementById("uploadform-web-name-label").classList.add("hidden");return t.getElementById("uploadform-web").classList.remove("hidden"),!0}}l(e=>{const t=e("#myTabTabs").find('a[href="#web"]');s.options.installfromon&&t.click(),t.hasClass("active")&&(n||(n=new a).initialise()),t.closest("li").click(()=>{n||(n=new a).initialise()}),""!==s.options.installfrom_url&&t.closest("li").click(),t.on("shown.bs.tab",()=>{n||(n=new a).initialise()})})})(window,document,Joomla,window.jQuery);